[Unit]
Description=Tomcat servlet container
After=network.target

[Service]
User={{ item.user|default(tomcat_default_user_name) }}
{% if item.umask is defined %}
UMask={{ item.umask }}
{% endif %}
{% if item.systemd_default_instance is defined %}
DefaultInstance={{ item.systemd_default_instance }}
{% endif %}
Restart=on-failure
Environment=TOMCAT_JAVA_HOME={{ ansible_local.java.general.java_home }}
Environment=CATALINA_HOME={{ tomcat_env_catalina_home }}
EnvironmentFile=-{{ item.home|default(tomcat_default_user_home) }}/catalina/%i/.systemd.conf

ExecStart={{ ansible_local.java.general.java_home }}/bin/java \
  -Djava.util.logging.config.file={{ item.home|default(tomcat_default_user_home) }}/catalina/%i/conf/logging.properties \
  -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \
  -Djava.endorsed.dirs={{ tomcat_env_catalina_home }}/endorsed \
  -Dcatalina.home={{ tomcat_env_catalina_home }} \
  -Dcatalina.base={{ item.home|default(tomcat_default_user_home) }}/catalina/%i \
  -Djava.io.tmpdir={{ item.home|default(tomcat_default_user_home) }}/%i/temp \
  -classpath "{{ tomcat_env_catalina_home }}/bin/bootstrap.jar:{{ tomcat_env_catalina_home }}/bin/tomcat-juli.jar" \
  org.apache.catalina.startup.Bootstrap start

ExecStop={{ ansible_local.java.general.java_home }}/bin/java \
  -Djava.util.logging.config.file={{ item.home|default(tomcat_default_user_home) }}/catalina/%i/conf/logging.properties \
  -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \
  -Djava.endorsed.dirs={{ tomcat_env_catalina_home }}/endorsed \
  -Dcatalina.home={{ tomcat_env_catalina_home }} \
  -Dcatalina.base={{ item.home|default(tomcat_default_user_home) }}/catalina/%i \
  -Djava.io.tmpdir={{ item.home|default(tomcat_default_user_home) }}/%i/temp \
  -classpath "{{ tomcat_env_catalina_home }}/bin/bootstrap.jar:{{ tomcat_env_catalina_home }}/bin/tomcat-juli.jar" \
  org.apache.catalina.startup.Bootstrap stop

[Install]
WantedBy=multi-user.target
